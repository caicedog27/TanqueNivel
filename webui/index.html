<!doctype html><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>TanqueNivel Industrial ‚Äì UX13</title>
<link rel="stylesheet" href="/static/style.css">
<div id="app" class="theme-dark">
  <header>
    <div class="brand"><h1>TanqueNivel Industrial <small>UX13</small></h1></div>
    <button id="controlsToggle" type="button" class="pill ghost controls-toggle" aria-expanded="true" aria-controls="topControls">
      <span class="label">Ocultar panel</span>
      <span class="chevron">‚ñ¥</span>
    </button>
    <div class="controls" id="topControls">
      <div class="accent">
        <button class="swatch" data-accent="#00b3ff" style="--c:#00b3ff"></button>
        <button class="swatch" data-accent="#2bd97c" style="--c:#2bd97c"></button>
        <button class="swatch" data-accent="#ff7a59" style="--c:#ff7a59"></button>
        <button class="swatch" data-accent="#a970ff" style="--c:#a970ff"></button>
      </div>
      <button id="themeToggle" class="icon" title="Tema"><span>üåì</span></button>
      <div class="apikey"><label>API Key <input id="apiKey" type="password" placeholder="DEVKEY123"></label><button id="saveKey" class="ghost">Guardar</button></div>
    </div>
  </header>
  <nav class="tabs glass" aria-label="Secciones principales">
    <button id="tabToggle" class="tab-toggle pill" aria-haspopup="true" aria-expanded="false">
      <span id="tabToggleLabel">Dashboard</span>
      <span class="chevron">‚ñæ</span>
    </button>
    <div class="tab-menu" role="menu">
      <button data-tab="dash" class="active" role="menuitem">Dashboard</button>
      <button data-tab="manual" role="menuitem">Manual</button>
      <button data-tab="auto" role="menuitem">Autom√°tico</button>
      <button data-tab="calib" role="menuitem">Calibraci√≥n</button>
      <button data-tab="profiles" role="menuitem">Perfiles</button>
      <button data-tab="history" role="menuitem">Gr√°ficas</button>
      <button data-tab="boards" role="menuitem">Equipos</button>
      <button data-tab="config" role="menuitem">Config</button>
      <button data-tab="events" role="menuitem">Eventos</button>
    </div>
  </nav>

  <section id="dash" class="tab active">
    <div class="cards">
      <div class="card glass big">
        <h3>Niveles</h3>
        <div class="level-grid">
          <div class="meter"><div class="gauge"><div class="gauge-bar" id="tankGauge"></div></div><div class="gauge-label">Tanque: <b id="tankPct">--</b>%</div></div>
          <div class="meter"><div class="gauge"><div class="gauge-bar" id="hopperGauge"></div></div><div class="gauge-label">Tolva: <b id="hopperPct">--</b>%</div></div>
        </div>
      </div>
      <div class="card glass"><h3>Estado</h3><ul class="kv">
        <li><span>Modo</span><b id="modeLbl">--</b></li>
        <li><span>Bomba</span><b id="pumpLbl" class="badge">--</b></li>
        <li><span>Duty</span><b><span id="onms">--</span>ms / <span id="offms">--</span>ms</b></li>
        <li><span>Frecuencia</span><b id="hzLbl">--</b></li>
        <li><span>Duty %</span><b id="dutyLbl">--</b></li>
        <li><span>Pulsos</span><b id="pulses">--</b></li>
        <li><span>Tiempo marcha</span><b id="runtime">--</b></li>
      </ul></div>
      <div class="card glass actions-card">
        <h3>Acciones r√°pidas</h3>
        <div class="quick-actions" id="dashActions">
          <button id="dashAutoToggle" class="pill wide">Iniciar autom√°tico</button>
          <button id="dashManualToggle" class="pill ghost wide">Encender bomba</button>
        </div>
        <p class="hint">Controla el modo activo directamente desde el Dashboard.</p>
      </div>
      <div class="card glass"><h3>Aprendizaje</h3><ul class="kv">
        <li><span>EMA ciclo</span><b id="emaRun">--</b> s</li>
        <li><span>Pendiente</span><b id="slope">--</b> %/s</li>
        <li><span>Inercia</span><b id="inertia">--</b> s</li>
        <li><span>Overshoot</span><b id="overshoot">--</b> %</li>
      </ul></div>
    </div>
  </section>

  <section id="manual" class="tab">
    <div class="card glass big">
      <h3>Control Manual</h3>
      <div class="manual-controls">
        <button id="btnManual" class="power"><span class="ring"></span><span class="dot"></span><span class="label">Encender</span></button>
        <div class="row knobs">
          <div class="knob"><label>ON (ms)</label><input type="range" id="onInput" min="20" max="5000" value="100"><div class="knob-value"><b id="onVal">100</b> ms</div></div>
          <div class="knob"><label>OFF (ms)</label><input type="range" id="offInput" min="10" max="10000" value="233"><div class="knob-value"><b id="offVal">233</b> ms</div></div>
          <button id="applyDuty" class="pill wide">Aplicar</button>
        </div>
        <canvas id="scope" width="960" height="160"></canvas>
      </div>
    </div>
  </section>

  <section id="auto" class="tab">
    <div class="card glass big">
      <h3>Autom√°tico</h3>
      <button id="btnAuto" class="power small"><span class="ring"></span><span class="dot"></span><span class="label">Iniciar</span></button>
      <div class="row">
        <label>Objetivo Tolva (%)<input type="number" id="targetPct" min="5" max="95" value="65"></label>
        <label>Hist√©resis (%)<input type="number" id="hystPct" min="1" max="15" value="5"></label>
        <label>Anti-derrame (%)<input type="number" id="spillGuard" min="0" max="5" value="1.2" step="0.1"></label>
        <label>Bloqueo tanque bajo (%)<input type="number" id="tankLowLock" min="0" max="50" value="15"></label>
        <button id="tankSensorToggle" class="pill ghost">Usar sensor tanque</button>
        <button id="applyAuto" class="pill ghost wide">Aplicar</button>
      </div>
    </div>
  </section>

  <section id="calib" class="tab">
    <div class="card glass big">
      <h3>Calibraci√≥n (mm)</h3>
      <div class="cards">
        <div class="card glass">
          <h4>Tanque</h4>
          <div class="row">
            <label>Vac√≠o (mm)<input id="tankEmpty" type="number" min="50" max="10000" step="1"></label>
            <label>Lleno (mm)<input id="tankFull" type="number" min="10" max="9999" step="1"></label>
          </div>
        </div>
        <div class="card glass">
          <h4>Tolva</h4>
          <div class="row">
            <label>Vac√≠o (mm)<input id="hopEmpty" type="number" min="50" max="10000" step="1"></label>
            <label>Lleno (mm)<input id="hopFull" type="number" min="10" max="9999" step="1"></label>
          </div>
        </div>
      </div>
      <div class="row"><button id="btnSaveCal" class="pill wide">Guardar calibraci√≥n</button></div>
      <p class="hint">Vac√≠o = distancia m√°s grande (sensor lejos). Lleno = distancia m√°s peque√±a.</p>
    </div>
  </section>

  <section id="profiles" class="tab">
    <div class="card glass big">
      <h3>Perfiles</h3>
      <div id="profilesList" class="list"></div>
      <div class="row">
        <label>Nombre<input id="profName"></label>
        <label>ON (ms)<input id="profOn" type="number" min="20" max="5000" value="100"></label>
        <label>OFF (ms)<input id="profOff" type="number" min="10" max="10000" value="233"></label>
        <button id="btnSaveProf" class="pill wide">Guardar perfil</button>
      </div>
    </div>
  </section>

  <section id="history" class="tab"><div class="card glass big"><h3>Gr√°ficas</h3><button id="refreshHistory" class="pill ghost wide">Actualizar</button><canvas id="plotLevels" width="980" height="200"></canvas><canvas id="plotRuntime" width="980" height="200"></canvas><canvas id="plotPulses" width="980" height="200"></canvas><canvas id="plotHz" width="980" height="200"></canvas><canvas id="plotDuty" width="980" height="200"></canvas><canvas id="plotOnMs" width="980" height="200"></canvas></div></section>

  <section id="boards" class="tab">
    <div class="card glass big">
      <h3>Equipos</h3>
      <div class="row">
        <button id="btnRefreshBoards" class="pill wide">Actualizar</button>
        <input id="newBoardId" placeholder="Board ID (p.ej. ACT-01)">
        <input id="newBoardTok" placeholder="Token">
        <input id="newBoardName" placeholder="Nombre opc.">
        <select id="newBoardKind"><option value="">Tipo...</option><option>ACTUATOR</option><option>SENSOR</option></select>
        <button id="btnAddBoard" class="pill ghost wide">Agregar</button>
      </div>
      <div id="boardsList" class="cards"></div>
      <p class="hint">La lista muestra los equipos esperados (configurados) con estado Online/Offline y su URL/Token de WebSocket listos para copiar.</p>
    </div>
  </section>

  <section id="config" class="tab"><div class="card glass big"><h3>Config</h3><div class="row"><label>Allowed Origins<input id="origins"></label><label>API Key<input id="apiKeyCfg"></label></div><button id="btnPatchCfg" class="pill wide">Guardar Config</button></div></section>
  <section id="events" class="tab"><div class="card glass big"><h3>Eventos</h3><pre id="eventsTail"></pre></div></section>
</div>
<div id="toast"></div>
<script src="/static/app.js"></script>
